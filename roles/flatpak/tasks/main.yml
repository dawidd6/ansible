- name: Add flathub remote
  community.general.flatpak_remote:
    method: user
    flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
    name: flathub

- name: Install flatpak packages
  community.general.flatpak:
    method: user
    name: "{{ item }}"
  loop: "{{ flatpak_install_packages }}"

- name: Set PATH for code flatpak
  vars:
    path: "/app/bin:/bin:{{ ansible_env.HOME }}/bin"
  ansible.builtin.command: "flatpak override --env=PATH={{ path }} --user com.visualstudio.code"
  changed_when: false

- name: Mount Docker socket inside code flatpak
  ansible.builtin.command: flatpak override --filesystem=/run/docker.sock --user com.visualstudio.code
  changed_when: false

- name: Mount tmp inside code flatpak
  ansible.builtin.command: flatpak override --filesystem=/tmp --user com.visualstudio.code
  changed_when: false
