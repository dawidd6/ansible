- name: Disable bt at startup
  become: true
  ansible.builtin.lineinfile:
    line: DEVICES_TO_DISABLE_ON_STARTUP="bluetooth"
    path: /etc/tlp.d/99-no-bluetooth-at-startup.conf
    mode: 0644
    create: true
  notify: Start tlp

- name: Create nvim directories
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload"
    state: directory
    mode: 0775

- name: Install nvim plugin manager
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    dest: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload/plug.vim"
    mode: 0775
  notify: Install nvim plugins

- name: Set fish as default shell
  become: true
  ansible.builtin.user:
    name: "{{ ansible_env.USER }}"
    shell: "{{ homebrew_prefix }}/bin/fish"

- name: Enable podman service
  ansible.builtin.shell: "{{ homebrew_prefix }}/bin/brew services start podman"
  register: brew_services
  changed_when: '"already started" not in brew_services.stdout'

- name: Flatpak override code
  ansible.builtin.command: "{{ item }}"
  changed_when: false
  loop:
    - flatpak override --user --reset com.visualstudio.code
    - flatpak override --user --filesystem=xdg-run/podman com.visualstudio.code
    - flatpak override --user --filesystem=/tmp com.visualstudio.code
    - "flatpak override --user --env=PATH=/app/bin:/bin:{{ ansible_env.HOME }}/bin com.visualstudio.code"
